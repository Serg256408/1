# Установка калькулятора асфальтирования в MODX

## Описание

Профессиональный калькулятор для расчёта стоимости работ по асфальтированию с дизайном ТРАНСКОМ / asfaltsneg.ru в бирюзовых тонах (#00c3b6).

## Быстрая установка

### Вариант 1: Вставка в чанк (рекомендуется)

1. В админ-панели MODX перейдите в **Элементы → Чанки**
2. Создайте новый чанк, например, `calculator-asphalt`
3. Скопируйте весь код из файла **`modx-chunk.html`**
4. Вставьте код в чанк и сохраните
5. На нужной странице вставьте:
   ```
   [[!$calculator-asphalt]]
   ```

### Вариант 2: Прямая вставка на страницу

1. Откройте нужную страницу в MODX
2. Переключитесь в режим HTML
3. Скопируйте весь код из файла **`modx-chunk.html`**
4. Вставьте код в нужное место на странице
5. Сохраните страницу

## Интеграция с формами

Калькулятор уже содержит MODX-теги для интеграции:

- `[[~[[*id]]]]` - автоматическая подстановка URL текущей страницы
- `[[!utmMark]]` - отслеживание UTM-меток (если используется)
- `[[*pagetitle]]` - название страницы
- `[[*uri]]` - URI страницы

### Настройка обработчика формы с AjaxForm + FormIt

**ШАГ 1: Создайте email-шаблон**

1. В MODX перейдите **Элементы → Чанки**
2. Создайте новый чанк `calcEmailTpl`
3. Скопируйте содержимое файла `email-template.html` из репозитория
4. Сохраните чанк

**ШАГ 2: Создайте чанк с калькулятором**

1. Создайте чанк `calculator-asphalt`
2. Скопируйте весь код из `modx-chunk.html`
3. Сохраните чанк

**ШАГ 3: Вставьте вызов на страницу**

На странице где нужен калькулятор вставьте:

```
[[!AjaxForm?
    &snippet=`FormIt`
    &form=`calculator-asphalt`
    &hooks=`email`
    &emailTpl=`calcEmailTpl`
    &emailSubject=`Новая заявка с калькулятора асфальтирования`
    &emailTo=`ваша@почта.ru`
    &validate=`name:required,phone:required`
    &validationErrorMessage=`Пожалуйста, заполните обязательные поля`
]]
```

**ВАЖНО:** Замените `ваша@почта.ru` на свой email!

### Альтернатива: Использование чистого FormIt (без AjaxForm)

Если у вас нет компонента AjaxForm, используйте стандартный FormIt:

```
[[!FormIt?
    &hooks=`email`
    &emailTpl=`calcEmailTpl`
    &emailSubject=`Новая заявка с калькулятора асфальтирования`
    &emailTo=`ваша@почта.ru`
    &validate=`name:required,phone:required`
]]

[[!$calculator-asphalt]]
```

### Проверка работы формы

1. Откройте страницу с калькулятором
2. Заполните параметры калькулятора
3. Убедитесь что расчёты показываются в таблице
4. Заполните имя и телефон
5. Нажмите кнопку отправки
6. Проверьте почту - должно прийти письмо со всеми данными

### Решение проблем

**Проблема: Письмо приходит пустое**

Причина: Скрытые поля не заполняются до отправки формы.

Решение: Убедитесь что:
1. Email-шаблон создан правильно с названием `calcEmailTpl`
2. В шаблоне используются правильные плейсхолдеры `[[+fieldname]]`
3. Калькулятор рассчитывает значения (проверьте таблицу результатов)

**Проблема: Форма не отправляется**

Решение:
1. Проверьте что FormIt установлен в MODX
2. Убедитесь что поля `name` и `phone` заполнены (они обязательные)
3. Проверьте логи MODX (Управление → Системные журналы)

## Передаваемые данные формы

### Видимые поля:
- `name` - Имя клиента
- `phone` - Телефон клиента
- `length` - Длина участка (м)
- `width` - Ширина участка (м)
- `area` - Площадь участка (м²)
- `sandThickness` - Толщина песка (см)
- `gravelThickness` - Толщина щебня (см)
- `asphaltThickness` - Толщина асфальта (см)
- `excavationDepth` - Глубина выемки (см)
- `curbQuantity` - Количество бордюров (шт)

### Скрытые поля (результаты расчётов):
- `sandVolume` / `sandCost` - Объём и стоимость песка
- `gravelVolume` / `gravelCost` - Объём и стоимость щебня
- `geotextileArea` / `geotextileCost` - Площадь и стоимость геотекстиля
- `geogridArea` / `geogridCost` - Площадь и стоимость геосетки
- `asphaltArea` / `asphaltCost` - Площадь и стоимость асфальта
- `emulsionVolume` / `emulsionCost` - Объём и стоимость битумной эмульсии
- `curbQuantity` / `curbCost` - Количество и стоимость бордюров
- `excavationVolume` / `excavationCost` - Объём и стоимость выемки грунта
- `soilRemovalVolume` / `soilRemovalCost` - Объём и стоимость вывоза грунта
- `totalCost` - Общая стоимость проекта
- `costPerSquare` - Стоимость за 1 м²

## Возможности калькулятора

✅ **Три типа нагрузки:**
- Пешеходное покрытие (тротуары, дорожки)
- Легковой транспорт (парковки, проезды)
- Грузовая нагрузка (дороги, площадки)

✅ **7 секций расчёта:**
1. Размеры участка
2. Песчаный слой с уплотнением
3. Щебёночный слой (4 типа щебня)
4. Геоматериалы (геотекстиль и геосетка)
5. Асфальтовое покрытие (5 типов асфальта)
6. Бордюры (дорожные и садовые)
7. Земляные работы с вывозом грунта

✅ **Дополнительно:**
- Интерактивные слайдеры и чекбоксы
- Расчёт в реальном времени
- Детальная таблица результатов
- Адаптивный дизайн для мобильных устройств
- Контактная форма для заявок

## Настройка цветов и стилей

Все стили находятся в блоке `<style>` в начале файла. Основные цвета:

- **Основной акцент**: `#00c3b6` (бирюзовый)
- **Тёмный фон**: `#111111`
- **Светлый фон секций**: `#ffffff`
- **Фон калькулятора**: `#f4f6f8`

Чтобы изменить цветовую схему, найдите и замените:
```css
#00c3b6  /* основной цвет бренда */
```

## Настройка цен

Цены указаны в JavaScript-коде в функции `calculate()`:

```javascript
// Песок - 2000 руб/м³
const sc=sv*2000;

// Щебень - разные типы
const priceG={limestone:4500,granite:5500,secondary:3500,gravel:5500};

// Геотекстиль - по плотности
geotextile.value==200?40:geotextile.value==300?60:geotextile.value==400?80

// Геосетка - 120 руб/м²
const grc=gri*120;

// Асфальт - базовая цена 1100 руб + 220 руб за каждый см толщины
const ap=1100+(ath-5)*220;

// Битумная эмульсия - 30 руб/м²
const em=emVol*30;

// Бордюры
const cp=curbType.value==='road'?1800:1000;

// Выемка грунта - 600 руб/м³
const exc=exv*600;

// Вывоз грунта - 600 руб/м³
const src=soilRem.checked?exv*600:0;
```

## Поддержка

Файлы в репозитории:
- `modx-chunk.html` - готовый код для MODX (используйте этот!)
- `index.html` - полная HTML-страница для тестирования
- `calculator.py` - Python-версия (базовый калькулятор)
- `test_calculator.py` - тесты для Python-версии

## Лицензия

Калькулятор создан для проекта ТРАНСКОМ / asfaltsneg.ru
