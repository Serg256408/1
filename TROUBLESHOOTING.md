# Решение проблемы: кнопка не работает, письмо не отправляется

## Диагностика проблемы

Если кнопка не работает и форма не отправляется, проверьте следующее:

### 1. Проверьте консоль браузера

1. Откройте страницу с калькулятором
2. Нажмите F12 (откроется консоль разработчика)
3. Перейдите на вкладку "Console" (Консоль)
4. Нажмите на кнопку отправки
5. Проверьте, есть ли ошибки JavaScript

**Частые ошибки:**
- `Uncaught TypeError: Cannot read property...` - означает что элемент формы не найден
- `Form is not defined` - означает что FormIt не создал форму правильно

### 2. Проверьте структуру HTML

Откройте "Inspect Element" (Инспектор элементов) и проверьте:

**ПРАВИЛЬНО:**
```html
<form action="..." method="post">
  <div class="calculator">
    <!-- содержимое калькулятора -->
    <button type="submit">...</button>
  </div>
</form>
```

**НЕПРАВИЛЬНО (если кнопка вне формы):**
```html
<div class="calculator">
  <!-- содержимое калькулятора -->
  <button type="submit">...</button>
</div>
<!-- форма создана ПОСЛЕ кнопки - не работает! -->
```

### 3. Проверьте настройку FormIt

Ваш вызов должен выглядеть так:

```
[[!FormIt?
    &hooks=`email,utmMark`
    &emailSubject=`Заявка с калькулятора асфальтирования`
    &emailTpl=`form2emailTpl`
    &emailTo=`info@asfaltsneg.ru`
    &emailFrom=`info@asfaltsneg.ru`
    &emailFromName=`Сайт Asfaltsneg.ru`
    &placeholderPrefix=`fi.`
]]

[[!$calculator-asphalt]]
```

**ВАЖНО:** FormIt должен быть ПЕРЕД вызовом чанка!

### 4. Проверьте, что чанки созданы правильно

#### Чанк calculator-asphalt:
- Код из файла `modx-chunk-formit.html`
- НЕТ тега `<form>` в коде (FormIt создаст его)

#### Чанк form2emailTpl:
- Код из файла `form2emailTpl.html`
- Все плейсхолдеры с префиксом `[[+fi.fieldname]]`

## Решение: Альтернативный метод

Если проблема не решается, используйте **встроенную форму** вместо FormIt:

### Вариант A: Используйте modx-chunk.html с AjaxForm

Это самый надёжный вариант:

1. Замените чанк `calculator-asphalt` на код из `modx-chunk.html` (не formit версию!)
2. Создайте чанк `calcEmailTpl` из `email-template.html` (без fi. префикса)
3. На странице:

```
[[!AjaxForm?
    &snippet=`FormIt`
    &form=`calculator-asphalt`
    &hooks=`email`
    &emailTpl=`calcEmailTpl`
    &emailSubject=`Заявка с калькулятора асфальтирования`
    &emailTo=`info@asfaltsneg.ru`
    &emailFrom=`info@asfaltsneg.ru`
    &validate=`name:required,phone:required`
]]
```

### Вариант B: Вообще без AjaxForm и FormIt

Используйте простую отправку формы на обработчик:

1. Используйте чанк из `modx-chunk.html`
2. Создайте сниппет обработчик или используйте другой пакет для отправки email

## Проверка работоспособности

После настройки:

1. ✅ Откройте калькулятор
2. ✅ Заполните параметры (длина, ширина)
3. ✅ Убедитесь что таблица с результатами показывает цифры
4. ✅ Заполните имя и телефон
5. ✅ Откройте консоль браузера (F12)
6. ✅ Нажмите "Получить расчёт"
7. ✅ Проверьте:
   - Нет ошибок в консоли?
   - Страница перезагрузилась или показала сообщение?
   - Пришло письмо на email?

## Частые ошибки

### Ошибка 1: "The form is not found"
**Причина:** FormIt не может найти чанк с формой
**Решение:** Проверьте название чанка в параметре `&form=`

### Ошибка 2: Письмо пустое
**Причина:** Email шаблон использует неправильные плейсхолдеры
**Решение:** Убедитесь что:
- Для FormIt: используйте `[[+fi.fieldname]]`
- Для AjaxForm: используйте `[[+fieldname]]` (без fi.)

### Ошибка 3: Кнопка нажимается, но ничего не происходит
**Причина:** Форма не обернута тегом `<form>` или JavaScript заблокирован
**Решение:** 
1. Проверьте в инспекторе, есть ли тег `<form>` вокруг калькулятора
2. Проверьте консоль на JavaScript ошибки
3. Попробуйте отключить другие скрипты на странице

### Ошибка 4: "Required field is empty"
**Причина:** Поля name или phone не заполнены
**Решение:** Заполните обязательные поля перед отправкой

## Логи для отладки

Для детальной диагностики включите логирование FormIt:

1. В MODX: Управление → Системные настройки
2. Найдите настройку `formit.debug`
3. Установите значение `Yes`
4. Проверьте логи в: Управление → Системные журналы

## Нужна помощь?

Если проблема не решается:

1. Проверьте все шаги выше
2. Сделайте скриншот консоли браузера (F12)
3. Сделайте скриншот HTML инспектора (покажите структуру формы)
4. Проверьте логи MODX
5. Укажите версию MODX и версию FormIt
